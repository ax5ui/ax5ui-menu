"use strict";!function(){var e=ax5.ui,t=ax5.ui.root,n=ax5.util,i="ax5menu",a="0.6.1",u=function(){var e,u=this;t&&t.call(this),this.name=i,this.version=a,this.instanceId=ax5.getGuid(),this.config={theme:"default",iconWidth:22,acceleratorWidth:100,menuBodyPadding:5,offset:{left:0,top:0},position:"fixed",animateTime:250,items:[],itemClickAndClose:!0},this.openTimer=null,this.closeTimer=null,this.queue=[],this.menuBar={},this.state=void 0,e=this.config;var l=function(e){e?(jQuery(document).unbind("click.ax5menu-"+this.menuId).bind("click.ax5menu-"+this.menuId,r.bind(this)),jQuery(window).unbind("keydown.ax5menu-"+this.menuId).bind("keydown.ax5menu-"+this.menuId,function(e){e.which==ax5.info.eventKeys.ESC&&u.close()}),jQuery(window).unbind("resize.ax5menu-"+this.menuId).bind("resize.ax5menu-"+this.menuId,function(e){u.close()})):(jQuery(document).unbind("click.ax5menu-"+this.menuId),jQuery(window).unbind("keydown.ax5menu-"+this.menuId),jQuery(window).unbind("resize.ax5menu-"+this.menuId))},c=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),u.state=t.state,e=null,t=null,!0},s=function(e){return this.onLoad&&this.onLoad.call(e,e),e=null,!0},o=function(){return'\n                <div class="ax5-ui-menu {{theme}}" {{#width}}style="width:{{width}}px;"{{/width}}>\n                    <div class="ax-menu-body">\n                        {{#items}}\n                            {{^@isMenu}}\n                                {{#divide}}\n                                <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                                {{/divide}}\n                                {{#html}}\n                                <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                                {{/html}}\n                            {{/@isMenu}}\n                            {{#@isMenu}}\n                            <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                                <span class="ax-menu-item-cell ax-menu-item-checkbox">\n                                    {{#check}}\n                                    <span class="item-checkbox-wrap useCheckBox" {{#checked}}data-item-checked="true"{{/checked}}></span>\n                                    {{/check}}\n                                    {{^check}}\n                                    <span class="item-checkbox-wrap"></span>\n                                    {{/check}}\n                                </span>\n                                {{#icon}}\n                                <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                                {{/icon}}\n                                <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                                {{#accelerator}}\n                                <span class="ax-menu-item-cell ax-menu-item-accelerator" style="width:{{cfg.acceleratorWidth}}px;"><span class="item-wrap">{{.}}</span></span>\n                                {{/accelerator}}\n                                {{#@hasChild}}\n                                <span class="ax-menu-item-cell ax-menu-item-handle">{{{cfg.icons.arrow}}}</span>\n                                {{/@hasChild}}\n                            </div>\n                            {{/@isMenu}}\n    \n                        {{/items}}\n                    </div>\n                    <div class="ax-menu-arrow"></div>\n                </div>\n                '},d=function(){return'\n                <div class="ax5-ui-menubar {{theme}}">\n                    <div class="ax-menu-body">\n                        {{#items}}\n                            {{^@isMenu}}\n                                {{#divide}}\n                                <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                                {{/divide}}\n                                {{#html}}\n                                <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                                {{/html}}\n                            {{/@isMenu}}\n                            {{#@isMenu}}\n                            <div class="ax-menu-item" data-menu-item-index="{{@i}}">\n                                {{#icon}}\n                                <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                                {{/icon}}\n                                <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                            </div>\n                            {{/@isMenu}}\n                        {{/items}}\n                    </div>\n                </div>\n                '},m=function f(t,n,i,a){var l,d,m=t;return m.theme=t.theme||e.theme,m.cfg={icons:jQuery.extend({},e.icons),iconWidth:t.iconWidth||e.iconWidth,acceleratorWidth:t.acceleratorWidth||e.acceleratorWidth},n.forEach(function(n){n.html||n.divide?(n["@isMenu"]=!1,n.html&&(n["@html"]=n.html.call({item:n,config:e,opt:t}))):n["@isMenu"]=!0}),m.items=n,m["@depth"]=i,m["@path"]=a||"root",m["@hasChild"]=function(){return this.items&&this.items.length>0},l=jQuery(ax5.mustache.render(o(),m)),jQuery(document.body).append(l),d=this.queue.splice(i),d.forEach(function(e){e.$target.remove()}),this.queue.push({$target:l,data:jQuery.extend({},m)}),l.find("[data-menu-item-index]").bind("mouseover",function(){var n,i,a,l,c,s,o=this.getAttribute("data-menu-item-depth"),d=this.getAttribute("data-menu-item-index"),m=this.getAttribute("data-menu-item-path");null!=o&&"undefined"!=typeof o&&(c=u.queue[o].data.items[d].items,s=u.queue[o].$target,s.find("[data-menu-item-index]").removeClass("hover"),jQuery(this).addClass("hover"),s.attr("data-selected-menu-item-index")!=d&&(s.attr("data-selected-menu-item-index",d),c&&c.length>0?(n=$(this),i=n.offset(),a="fixed"==e.position?$(document).scrollTop():0,l={"@parent":{left:i.left,top:i.top,width:n.outerWidth(),height:n.outerHeight()},left:i.left+n.outerWidth()-e.menuBodyPadding,top:i.top-e.menuBodyPadding-1-a},l=jQuery.extend(!0,t,l),f.call(u,l,c,Number(o)+1,m)):u.queue.splice(Number(o)+1).forEach(function(e){e.$target.remove()}))),o=null,d=null,m=null,n=null,i=null,a=null,l=null,c=null,s=null}),0==i&&(m.direction&&l.addClass("direction-"+m.direction),c.call(this,null,{self:this,items:n,parent:function(e){if(!e)return!1;var t=null;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(u)}catch(n){}return t}(m["@path"]),state:"popup"})),h.call(this,l,m),s.call(this,{self:this,items:n,element:l.get(0)}),m=null,l=null,d=null,t=null,n=null,i=null,a=null,this},r=function(t,i,a){if(i=n.findParentNode(t.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0})){if(a=function(e){if(!e)return!1;var t;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(u)}catch(n){console.log(ax5.info.getError("ax5menu","501","menuItemClick"))}try{return t}finally{t=null}}(i.getAttribute("data-menu-item-path")),!a)return this;a.check&&(function(e){var t={checkbox:function(e){this.checked=!e},radio:function(t){var n=this.name;e.forEach(function(e){e.check&&"radio"===e.check.type&&e.check.name==n&&(e.check.checked=!1)}),this.checked=!t}};t[this.type]&&t[this.type].call(this,this.checked),t=null}.call(a.check,e.items),e.itemClickAndClose||u.queue.forEach(function(e){e.$target.find("[data-menu-item-index]").each(function(){var t=e.data.items[this.getAttribute("data-menu-item-index")];t.check&&jQuery(this).find(".item-checkbox-wrap").attr("data-item-checked",t.check.checked)})})),u.onClick&&u.onClick.call(a,a),a.items&&0!=a.items.length||!e.itemClickAndClose||u.close()}else u.close();return i=null,a=null,this},h=function(t,n){var i=$(window),a=$(document),u="fixed"==e.position?i.height():a.height(),l=i.width(),c=t.outerHeight(),s=t.outerWidth(),o=n.left,d=n.top,m=e.position||"fixed";return o+s>l&&(o=n["@parent"]?n["@parent"].left-s+e.menuBodyPadding:l-s),d+c>u&&(d=u-c),t.css({left:o,top:d,position:m}),t=null,n=null,i=null,a=null,u=null,l=null,c=null,s=null,o=null,d=null,m=null,this};this.init=function(){u.menuId=ax5.getGuid(),this.onStateChanged=e.onStateChanged,this.onClick=e.onClick,this.onLoad=e.onLoad,c.call(this,null,{self:this,state:"init"})},this.popup=function(){var t={event:function(t,n){t={left:t.clientX,top:"fixed"==e.position?t.clientY:t.pageY,width:e.width,theme:e.theme},e.offset&&(e.offset.left&&(t.left+=e.offset.left),e.offset.top&&(t.top+=e.offset.top)),n=jQuery.extend(!0,t,n);try{return n}finally{t=null}},object:function(t,n){t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme},e.offset&&(e.offset.left&&(t.left+=e.offset.left),e.offset.top&&(t.top+=e.offset.top)),n=jQuery.extend(!0,t,n);try{return n}finally{t=null}}},n=function(t){t&&(e.theme=t)};return function(i,a){return i?(a=t["undefined"==typeof i.clientX?"object":"event"].call(this,i,a),n(a.theme),m.call(this,a,e.items,0),l.call(this,!0),i=null,this):this}}(),this.attach=function(){var t={object:function(t,n){t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme,direction:t.direction||e.direction},n=jQuery.extend(!0,n,t);try{return n}finally{t=null,n=null}}},i=function(n,i){var a=$(n),c=a.offset(),s=a.outerHeight(),o=Number(n.getAttribute("data-menu-item-index")),d="fixed"==e.position?$(document).scrollTop():0;return u.menuBar.openedIndex==o?!1:(u.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),u.menuBar.opened=!0,u.menuBar.openedIndex=o,a.attr("data-menu-item-opened","true"),a.addClass("hover"),e.offset&&(e.offset.left&&(c.left+=e.offset.left),e.offset.top&&(c.top+=e.offset.top)),i=t.object.call(this,{left:c.left,top:c.top+s-d},i),e.items&&e.items[o].items&&e.items[o].items.length&&(m.call(u,i,e.items[o].items,0,"root."+n.getAttribute("data-menu-item-index")),l.call(u,!0)),n=null,i=null,a=null,c=null,s=null,o=null,void(d=null))};return function(t,a){var l,c={},s=e.items;return"undefined"==typeof a&&(a={}),c.theme=a.theme||e.theme,c.cfg={icons:jQuery.extend({},e.icons),iconWidth:a.iconWidth||e.iconWidth,acceleratorWidth:a.acceleratorWidth||e.acceleratorWidth},s.forEach(function(t){t.html||t.divide?(t["@isMenu"]=!1,t.html&&(t["@html"]=t.html.call({item:t,config:e,opt:a}))):t["@isMenu"]=!0}),c.items=s,l=jQuery(ax5.mustache.render(d(),c)),u.menuBar={target:jQuery(t),opened:!1},u.menuBar.target.html(l),u.menuBar.target.bind("click",function(e){if(!e)return this;var t=n.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});t&&i(t,a),t=null}),u.menuBar.target.bind("mouseover",function(e){if(!u.menuBar.opened)return!1;var t=n.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});t&&i(t,a),t=null}),t=null,a=null,c=null,s=null,l=null,this}}(),this.close=function(){return u.menuBar&&u.menuBar.target&&(u.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),u.menuBar.opened=!1,u.menuBar.openedIndex=null),l.call(this,!1),this.queue.forEach(function(e){e.$target.remove()}),this.queue=[],c.call(this,null,{self:this,state:"close"}),this},this.getCheckValue=function(){var t={},i=function(e){for(var a=e.length;a--;)e[a].check&&e[a].check.checked&&(t[e[a].check.name]?(n.isString(t[e[a].check.name])&&(t[e[a].check.name]=[t[e[a].check.name]]),t[e[a].check.name].push(e[a].check.value)):t[e[a].check.name]=e[a].check.value),e[a].items&&e[a].items.length>0&&i(e[a].items)};i(e.items);try{return t}finally{t=null,i=null}},this.main=function(){root.menu_instance=root.menu_instance||[],root.menu_instance.push(this),arguments&&n.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.menu=function(){return n.isFunction(t)&&(u.prototype=new t),u}()}();