"use strict";!function(e,t){var n=ax5.util,i=function(){var e,i=this;t&&t.call(this),this.config={theme:"default",iconWidth:22,acceleratorWidth:100,menuBodyPadding:5,offset:{left:0,top:0},position:"fixed",animateTime:250,items:[],itemClickAndClose:!0},this.openTimer=null,this.closeTimer=null,this.queue=[],this.menuBar={},e=this.config;var a=function(e){e?(jQuery(document).unbind("click.ax5menu-"+i.menuId).bind("click.ax5menu-"+i.menuId,i.__clickItem.bind(this)),jQuery(window).unbind("keydown.ax5menu-"+i.menuId).bind("keydown.ax5menu-"+i.menuId,function(e){e.which==ax5.info.eventKeys.ESC&&i.close()}),jQuery(window).unbind("resize.ax5menu-"+i.menuId).bind("resize.ax5menu-"+i.menuId,function(e){i.close()})):(jQuery(document).unbind("click.ax5menu-"+i.menuId),jQuery(window).unbind("keydown.ax5menu-"+i.menuId),jQuery(window).unbind("resize.ax5menu-"+i.menuId))};this.init=function(){var t;i.menuId=ax5.getGuid(),this.onStateChanged=e.onStateChanged,this.onClick=e.onClick,this.onLoad=e.onLoad,this.onStateChanged&&(t={self:this,state:"init"},this.onStateChanged.call(t,t))},this.__getTmpl=function(){return'\n            <div class="ax5-ui-menu {{theme}}">\n                <div class="ax-menu-body">\n                    {{#items}}\n                        {{^@isMenu}}\n                            {{#divide}}\n                            <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                            {{/divide}}\n                            {{#html}}\n                            <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                            {{/html}}\n                        {{/@isMenu}}\n                        {{#@isMenu}}\n                        <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                            <span class="ax-menu-item-cell ax-menu-item-checkbox">\n                                {{#check}}\n                                <span class="item-checkbox-wrap useCheckBox" {{#checked}}data-item-checked="true"{{/checked}}></span>\n                                {{/check}}\n                                {{^check}}\n                                <span class="item-checkbox-wrap"></span>\n                                {{/check}}\n                            </span>\n                            {{#icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                            {{/icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                            {{#accelerator}}\n                            <span class="ax-menu-item-cell ax-menu-item-accelerator" style="width:{{cfg.acceleratorWidth}}px;"><span class="item-wrap">{{.}}</span></span>\n                            {{/accelerator}}\n                            {{#@hasChild}}\n                            <span class="ax-menu-item-cell ax-menu-item-handle">{{{cfg.icons.arrow}}}</span>\n                            {{/@hasChild}}\n                        </div>\n                        {{/@isMenu}}\n\n                    {{/items}}\n                </div>\n                <div class="ax-menu-arrow"></div>\n            </div>\n            '},this.__getTmpl_menuBar=function(){return'\n            <div class="ax5-ui-menubar {{theme}}">\n                <div class="ax-menu-body">\n                    {{#items}}\n                        {{^@isMenu}}\n                            {{#divide}}\n                            <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                            {{/divide}}\n                            {{#html}}\n                            <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                            {{/html}}\n                        {{/@isMenu}}\n                        {{#@isMenu}}\n                        <div class="ax-menu-item" data-menu-item-index="{{@i}}">\n                            {{#icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                            {{/icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                        </div>\n                        {{/@isMenu}}\n                    {{/items}}\n                </div>\n            </div>\n            '},this.__popup=function(t,n,a,c){var o,s,u=t;u.theme=t.theme||e.theme,u.cfg={icons:jQuery.extend({},e.icons),iconWidth:t.iconWidth||e.iconWidth,acceleratorWidth:t.acceleratorWidth||e.acceleratorWidth},n.forEach(function(n){n.html||n.divide?(n["@isMenu"]=!1,n.html&&(n["@html"]=n.html.call({item:n,config:e,opt:t}))):n["@isMenu"]=!0}),u.items=n,u["@depth"]=a,u["@path"]=c||"root",u["@hasChild"]=function(){return this.items&&this.items.length>0},o=jQuery(ax5.mustache.render(this.__getTmpl(),u)),jQuery(document.body).append(o);var d=this.queue.splice(a);return d.forEach(function(e){e.$target.remove()}),this.queue.push({$target:o,data:jQuery.extend({},u)}),o.find("[data-menu-item-index]").bind("mouseover",function(){var a=this.getAttribute("data-menu-item-depth"),c=this.getAttribute("data-menu-item-index"),s=this.getAttribute("data-menu-item-path");if(o.find("[data-menu-item-index]").removeClass("hover"),jQuery(this).addClass("hover"),o.attr("data-selected-menu-item-index")!=c)if(o.attr("data-selected-menu-item-index",c),n[c].items&&n[c].items.length>0){var u=$(this),d=u.offset(),m="fixed"==e.position?$(document).scrollTop():0,r={"@parent":{left:d.left,top:d.top,width:u.outerWidth(),height:u.outerHeight()},left:d.left+u.outerWidth()-e.menuBodyPadding,top:d.top-e.menuBodyPadding-1-m};r=jQuery.extend(!0,t,r),i.__popup(r,n[c].items,a+1,s)}else i.queue.splice(Number(a)+1).forEach(function(e){e.$target.remove()})}),0==a&&(u.direction&&o.addClass("direction-"+u.direction),this.onStateChanged&&(s={self:this,items:n,parent:function(e){if(!e)return!1;var t=null;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(i)}catch(n){}return t}(u["@path"]),state:"popup"},this.onStateChanged.call(s,s))),this.__align(o,u),this.onLoad&&(s={self:this,items:n,element:o.get(0)},this.onLoad.call(s,s)),this},this.__clickItem=function(t){var a=n.findParentNode(t.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});if(a){var c=function(e){if(!e)return!1;var t;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(i)}catch(n){console.log(ax5.info.getError("ax5menu","501","menuItemClick"))}return t}(a.getAttribute("data-menu-item-path"));if(!c)return this;c.check&&(function(e){var t={checkbox:function(e){this.checked=!e},radio:function(t){var n=this.name;e.forEach(function(e){e.check&&"radio"===e.check.type&&e.check.name==n&&(e.check.checked=!1)}),this.checked=!t}};t[this.type]&&t[this.type].call(this,this.checked)}.call(c.check,e.items),e.itemClickAndClose||i.queue.forEach(function(e){e.$target.find("[data-menu-item-index]").each(function(){var t=e.data.items[this.getAttribute("data-menu-item-index")];t.check&&jQuery(this).find(".item-checkbox-wrap").attr("data-item-checked",t.check.checked)})})),i.onClick&&i.onClick.call(c,c),c.items&&0!=c.items.length||!e.itemClickAndClose||i.close()}else i.close();return this},this.__align=function(t,n){var i=$(window),a=$(document),c="fixed"==e.position?i.height():a.height(),o=i.width(),s=t.outerHeight(),u=t.outerWidth(),d=n.left,m=n.top,r=e.position||"fixed";return d+u>o&&(d=n["@parent"]?n["@parent"].left-u+e.menuBodyPadding:o-u),m+s>c&&(m=c-s),t.css({left:d,top:m,position:r}),this},this.popup=function(){var t={event:function(t,n){return t={left:t.clientX,top:"fixed"==e.position?t.clientY:t.pageY,width:e.width,theme:e.theme},e.offset&&(e.offset.left&&(t.left+=e.offset.left),e.offset.top&&(t.top+=e.offset.top)),n=jQuery.extend(!0,t,n)},object:function(t,n){return t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme},e.offset&&(e.offset.left&&(t.left+=e.offset.left),e.offset.top&&(t.top+=e.offset.top)),n=jQuery.extend(!0,t,n)}};return function(n,i){return n?(i=t["undefined"==typeof n.clientX?"object":"event"].call(this,n,i),this.__popup(i,e.items,0),a(!0),this):this}}(),this.attach=function(){var t={object:function(t,n){return t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme,direction:t.direction||e.direction},n=jQuery.extend(!0,n,t)}},c=function(n,c){var o=$(n),s=o.offset(),u=o.outerHeight(),d=Number(n.getAttribute("data-menu-item-index")),m="fixed"==e.position?$(document).scrollTop():0;return i.menuBar.openedIndex==d?!1:(i.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),i.menuBar.opened=!0,i.menuBar.openedIndex=d,o.attr("data-menu-item-opened","true"),o.addClass("hover"),e.offset&&(e.offset.left&&(s.left+=e.offset.left),e.offset.top&&(s.top+=e.offset.top)),c=t.object.call(this,{left:s.left,top:s.top+u-m},c),void(e.items&&e.items[d].items&&e.items[d].items.length&&(i.__popup(c,e.items[d].items,0,"root."+n.getAttribute("data-menu-item-index")),a(!0))))};return function(t,a){var o={},s=e.items;"undefined"==typeof a&&(a={}),o.theme=a.theme||e.theme,o.cfg={icons:jQuery.extend({},e.icons),iconWidth:a.iconWidth||e.iconWidth,acceleratorWidth:a.acceleratorWidth||e.acceleratorWidth},s.forEach(function(t){t.html||t.divide?(t["@isMenu"]=!1,t.html&&(t["@html"]=t.html.call({item:t,config:e,opt:a}))):t["@isMenu"]=!0}),o.items=s;var u=jQuery(ax5.mustache.render(this.__getTmpl_menuBar(),o));return i.menuBar={target:jQuery(t),opened:!1},i.menuBar.target.html(u),i.menuBar.target.bind("click",function(e){if(!e)return this;var t=n.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});t&&c(t,a)}),i.menuBar.target.bind("mouseover",function(e){if(!i.menuBar.opened)return!1;var t=n.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});t&&c(t,a)}),this}}(),this.close=function(){var e;return i.menuBar&&i.menuBar.target&&(i.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),i.menuBar.opened=!1,i.menuBar.openedIndex=null),a(!1),this.queue.forEach(function(e){e.$target.remove()}),this.queue=[],this.onStateChanged&&(e={self:this,state:"close"},this.onStateChanged.call(e,e)),this},this.getCheckValue=function(){var t={},i=function a(e){for(var i=e.length;i--;)e[i].check&&e[i].check.checked&&(t[e[i].check.name]?(n.isString(t[e[i].check.name])&&(t[e[i].check.name]=[t[e[i].check.name]]),t[e[i].check.name].push(e[i].check.value)):t[e[i].check.name]=e[i].check.value),e[i].items&&e[i].items.length>0&&a(e[i].items)};return i(e.items),t},this.main=function(){arguments&&n.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.menu=function(){return n.isFunction(t)&&(i.prototype=new t),i}()}(ax5.ui,ax5.ui.root);