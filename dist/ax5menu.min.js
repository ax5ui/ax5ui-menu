"use strict";!function(){var e=ax5.ui,t=ax5.util;e.addClass({className:"menu",version:"0.6.5"},function(){var n=function(){var n,i=this;this.instanceId=ax5.getGuid(),this.config={theme:"default",iconWidth:22,acceleratorWidth:100,menuBodyPadding:5,offset:{left:0,top:0},position:"fixed",animateTime:250,items:[],itemClickAndClose:!0,columnKeys:{label:"label",items:"items"}},this.openTimer=null,this.closeTimer=null,this.queue=[],this.menuBar={},this.state=void 0,n=this.config;var u=function(e){e?(jQuery(document).unbind("click.ax5menu-"+this.menuId).bind("click.ax5menu-"+this.menuId,m.bind(this)),jQuery(window).unbind("keydown.ax5menu-"+this.menuId).bind("keydown.ax5menu-"+this.menuId,function(e){e.which==ax5.info.eventKeys.ESC&&i.close()}),jQuery(window).unbind("resize.ax5menu-"+this.menuId).bind("resize.ax5menu-"+this.menuId,function(e){i.close()})):(jQuery(document).unbind("click.ax5menu-"+this.menuId),jQuery(window).unbind("keydown.ax5menu-"+this.menuId),jQuery(window).unbind("resize.ax5menu-"+this.menuId))},l=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),i.state=t.state,e=null,t=null,!0},a=function(e){return this.onLoad&&this.onLoad.call(e,e),e=null,!0},c=function(e){return'\n                    <div class="ax5-ui-menu {{theme}}" {{#width}}style="width:{{width}}px;"{{/width}}>\n                        <div class="ax-menu-body">\n                            {{#'+e.items+'}}\n                                {{^@isMenu}}\n                                    {{#divide}}\n                                    <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                                    {{/divide}}\n                                    {{#html}}\n                                    <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                                    {{/html}}\n                                {{/@isMenu}}\n                                {{#@isMenu}}\n                                <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                                    <span class="ax-menu-item-cell ax-menu-item-checkbox">\n                                        {{#check}}\n                                        <span class="item-checkbox-wrap useCheckBox" {{#checked}}data-item-checked="true"{{/checked}}></span>\n                                        {{/check}}\n                                        {{^check}}\n                                        <span class="item-checkbox-wrap"></span>\n                                        {{/check}}\n                                    </span>\n                                    {{#icon}}\n                                    <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                                    {{/icon}}\n                                    <span class="ax-menu-item-cell ax-menu-item-label">{{{'+e.label+'}}}</span>\n                                    {{#accelerator}}\n                                    <span class="ax-menu-item-cell ax-menu-item-accelerator" style="width:{{cfg.acceleratorWidth}}px;"><span class="item-wrap">{{.}}</span></span>\n                                    {{/accelerator}}\n                                    {{#@hasChild}}\n                                    <span class="ax-menu-item-cell ax-menu-item-handle">{{{cfg.icons.arrow}}}</span>\n                                    {{/@hasChild}}\n                                </div>\n                                {{/@isMenu}}\n        \n                            {{/'+e.items+'}}\n                        </div>\n                        <div class="ax-menu-arrow"></div>\n                    </div>\n                    '},s=function(e){return'\n                    <div class="ax5-ui-menubar {{theme}}">\n                        <div class="ax-menu-body">\n                            {{#'+e.items+'}}\n                                {{^@isMenu}}\n                                    {{#divide}}\n                                    <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                                    {{/divide}}\n                                    {{#html}}\n                                    <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                                    {{/html}}\n                                {{/@isMenu}}\n                                {{#@isMenu}}\n                                <div class="ax-menu-item" data-menu-item-index="{{@i}}">\n                                    {{#icon}}\n                                    <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                                    {{/icon}}\n                                    <span class="ax-menu-item-cell ax-menu-item-label">{{{'+e.label+"}}}</span>\n                                </div>\n                                {{/@isMenu}}\n                            {{/"+e.items+"}}\n                        </div>\n                    </div>\n                    "},o=function r(e,t,u,s){var o,m,h=e;return h.theme=e.theme||n.theme,h.cfg={icons:jQuery.extend({},n.icons),iconWidth:e.iconWidth||n.iconWidth,acceleratorWidth:e.acceleratorWidth||n.acceleratorWidth},t.forEach(function(t){t.html||t.divide?(t["@isMenu"]=!1,t.html&&(t["@html"]=t.html.call({item:t,config:n,opt:e}))):t["@isMenu"]=!0}),h[n.columnKeys.items]=t,h["@depth"]=u,h["@path"]=s||"root",h["@hasChild"]=function(){return this[n.columnKeys.items]&&this[n.columnKeys.items].length>0},o=jQuery(ax5.mustache.render(c(n.columnKeys),h)),jQuery(document.body).append(o),m=this.queue.splice(u),m.forEach(function(e){e.$target.remove()}),this.queue.push({$target:o,data:jQuery.extend({},h)}),o.find("[data-menu-item-index]").bind("mouseover",function(){var t,u,l,a,c,s,o=this.getAttribute("data-menu-item-depth"),m=this.getAttribute("data-menu-item-index"),d=this.getAttribute("data-menu-item-path");null!=o&&"undefined"!=typeof o&&(c=i.queue[o].data[n.columnKeys.items][m][n.columnKeys.items],s=i.queue[o].$target,s.find("[data-menu-item-index]").removeClass("hover"),jQuery(this).addClass("hover"),s.attr("data-selected-menu-item-index")!=m&&(s.attr("data-selected-menu-item-index",m),c&&c.length>0?(t=jQuery(this),u=t.offset(),l="fixed"==n.position?jQuery(document).scrollTop():0,a={"@parent":{left:u.left,top:u.top,width:t.outerWidth(),height:t.outerHeight()},left:u.left+t.outerWidth()-n.menuBodyPadding,top:u.top-n.menuBodyPadding-1-l},a=jQuery.extend(!0,e,a),r.call(i,a,c,Number(o)+1,d)):i.queue.splice(Number(o)+1).forEach(function(e){e.$target.remove()}))),o=null,m=null,d=null,t=null,u=null,l=null,a=null,c=null,s=null}),0==u&&(h.direction&&o.addClass("direction-"+h.direction),l.call(this,null,{self:this,items:t,parent:function(e){if(!e)return!1;var t=null;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(i)}catch(n){}return t}(h["@path"]),state:"popup"})),d.call(this,o,h),a.call(this,{self:this,items:t,element:o.get(0)}),h=null,o=null,m=null,e=null,t=null,u=null,s=null,this},m=function(e,u,l){if(u=t.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0})){if(l=function(e){if(!e)return!1;var t;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"]."+n.columnKeys.items+"[")+"];").call(i)}catch(u){console.log(ax5.info.getError("ax5menu","501","menuItemClick"))}try{return t}finally{t=null}}(u.getAttribute("data-menu-item-path")),!l)return this;l.check&&(function(e){var t={checkbox:function(e){this.checked=!e},radio:function(t){var n=this.name;e.forEach(function(e){e.check&&"radio"===e.check.type&&e.check.name==n&&(e.check.checked=!1)}),this.checked=!t}};t[this.type]&&t[this.type].call(this,this.checked),t=null}.call(l.check,n.items),n.itemClickAndClose||i.queue.forEach(function(e){e.$target.find("[data-menu-item-index]").each(function(){var t=e.data[n.columnKeys.items][this.getAttribute("data-menu-item-index")];t.check&&jQuery(this).find(".item-checkbox-wrap").attr("data-item-checked",t.check.checked)})})),i.onClick&&i.onClick.call(l,l),l[n.columnKeys.items]&&0!=l[n.columnKeys.items].length||!n.itemClickAndClose||i.close()}else i.close();return u=null,l=null,this},d=function(e,t){var i=jQuery(window),u=jQuery(document),l="fixed"==n.position?i.height():u.height(),a=i.width(),c=e.outerHeight(),s=e.outerWidth(),o=t.left,m=t.top,d=n.position||"fixed";return o+s>a&&(o=t["@parent"]?t["@parent"].left-s+n.menuBodyPadding:a-s),m+c>l&&(m=l-c),e.css({left:o,top:m,position:d}),e=null,t=null,i=null,u=null,l=null,a=null,c=null,s=null,o=null,m=null,d=null,this};this.init=function(){i.menuId=ax5.getGuid(),this.onStateChanged=n.onStateChanged,this.onClick=n.onClick,this.onLoad=n.onLoad,l.call(this,null,{self:this,state:"init"})},this.popup=function(){var e={event:function(e,t){e={left:e.clientX,top:"fixed"==n.position?e.clientY:e.pageY,width:n.width,theme:n.theme},n.offset&&(n.offset.left&&(e.left+=n.offset.left),n.offset.top&&(e.top+=n.offset.top)),t=jQuery.extend(!0,e,t);try{return t}finally{e=null}},object:function(e,t){e={left:e.left,top:e.top,width:e.width||n.width,theme:e.theme||n.theme},n.offset&&(n.offset.left&&(e.left+=n.offset.left),n.offset.top&&(e.top+=n.offset.top)),t=jQuery.extend(!0,e,t);try{return t}finally{e=null}}},t=function(e){e&&(n.theme=e)};return function(i,l){if(!i)return this;l=e["undefined"==typeof i.clientX?"object":"event"].call(this,i,l),t(l.theme);var a=[].concat(n.items);if(l.filter){var c=function s(e){var t=[];return e.forEach(function(e){e.items&&e.items.length>0&&(e.items=s(e.items)),l.filter.call(e)&&t.push(e)}),t};a=c(a)}return o.call(this,l,a,0),u.call(this,!0),i=null,this}}(),this.attach=function(){var e={object:function(e,t){e={left:e.left,top:e.top,width:e.width||n.width,theme:e.theme||n.theme,direction:e.direction||n.direction},t=jQuery.extend(!0,t,e);try{return t}finally{e=null,t=null}}},l=function(t,l,a){var c=jQuery(t),s=c.offset(),m=c.outerHeight(),d=Number(t.getAttribute("data-menu-item-index")),r="fixed"==n.position?jQuery(document).scrollTop():0;return i.menuBar.openedIndex==d?("click"==a&&i.close(),!1):(i.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),i.menuBar.opened=!0,i.menuBar.openedIndex=d,c.attr("data-menu-item-opened","true"),c.addClass("hover"),n.offset&&(n.offset.left&&(s.left+=n.offset.left),n.offset.top&&(s.top+=n.offset.top)),l=e.object.call(this,{left:s.left,top:s.top+m-r},l),n.items&&n.items[d][n.columnKeys.items]&&n.items[d][n.columnKeys.items].length&&(o.call(i,l,n.items[d][n.columnKeys.items],0,"root."+t.getAttribute("data-menu-item-index")),u.call(i,!0)),t=null,l=null,c=null,s=null,m=null,d=null,void(r=null))};return function(e,u){var a,c={},o=n.items;return"undefined"==typeof u&&(u={}),c.theme=u.theme||n.theme,c.cfg={icons:jQuery.extend({},n.icons),iconWidth:u.iconWidth||n.iconWidth,acceleratorWidth:u.acceleratorWidth||n.acceleratorWidth},o.forEach(function(e){e.html||e.divide?(e["@isMenu"]=!1,e.html&&(e["@html"]=e.html.call({item:e,config:n,opt:u}))):e["@isMenu"]=!0}),c[n.columnKeys.items]=o,a=jQuery(ax5.mustache.render(s(n.columnKeys),c)),i.menuBar={target:jQuery(e),opened:!1},i.menuBar.target.html(a),i.menuBar.target.bind("click",function(e){if(!e)return this;var n=t.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});n&&l(n,u,"click"),n=null}),i.menuBar.target.bind("mouseover",function(e){if(!i.menuBar.opened)return!1;var n=t.findParentNode(e.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});n&&l(n,u,"mouseover"),n=null}),e=null,u=null,c=null,o=null,a=null,this}}(),this.close=function(){return i.menuBar&&i.menuBar.target&&(i.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),i.menuBar.opened=!1,i.menuBar.openedIndex=null),u.call(this,!1),this.queue.forEach(function(e){e.$target.remove()}),this.queue=[],l.call(this,null,{self:this,state:"close"}),this},this.getCheckValue=function(){var e={},i=function(n){for(var u=n.length;u--;)n[u].check&&n[u].check.checked&&(e[n[u].check.name]?(t.isString(e[n[u].check.name])&&(e[n[u].check.name]=[e[n[u].check.name]]),e[n[u].check.name].push(n[u].check.value)):e[n[u].check.name]=n[u].check.value),n[u].items&&n[u].items.length>0&&i(n[u].items)};i(n.items);try{return e}finally{e=null,i=null}},this.main=function(){e.menu_instance=e.menu_instance||[],e.menu_instance.push(this),arguments&&t.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return n}())}();