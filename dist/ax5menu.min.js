"use strict";!function(e,t){var i=ax5.util,n=function(){var e,n=this;t&&t.call(this),this.config={theme:"default",iconWidth:22,acceleratorWidth:100,menuBodyPadding:5,position:{left:0,top:0},animateTime:250,items:[]},this.openTimer=null,this.closeTimer=null,this.queue=[],e=this.config,this.init=function(){var t;n.menuId=ax5.getGuid(),e.onStateChanged&&(t={self:this,state:"init"},e.onStateChanged.call(t,t))},this.__getTmpl=function(){return'\n            <div class="ax5-ui-menu {{theme}}">\n                <div class="ax-menu-body">\n                    {{#items}}\n                        {{^@isMenu}}\n                            {{#divide}}\n                            <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                            {{/divide}}\n                            {{#html}}\n                            <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                            {{/html}}\n                        {{/@isMenu}}\n                        {{#@isMenu}}\n                        <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                            <span class="ax-menu-item-cell ax-menu-item-checkbox">\n                                {{#check}}\n                                <span class="item-checkbox-wrap useCheckBox" {{#checked}}data-item-checked="true"{{/checked}}></span>\n                                {{/check}}\n                                {{^check}}\n                                <span class="item-checkbox-wrap"></span>\n                                {{/check}}\n                            </span>\n                            {{#icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                            {{/icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                            {{#accelerator}}\n                            <span class="ax-menu-item-cell ax-menu-item-accelerator" style="width:{{cfg.acceleratorWidth}}px;"><span class="item-wrap">{{.}}</span></span>\n                            {{/accelerator}}\n                            {{#@hasChild}}\n                            <span class="ax-menu-item-cell ax-menu-item-handle">{{{cfg.icons.arrow}}}</span>\n                            {{/@hasChild}}\n                        </div>\n                        {{/@isMenu}}\n\n                    {{/items}}\n                </div>\n                <div class="ax-menu-arrow"></div>\n            </div>\n            '},this.__getTmpl_menuBar=function(){return'\n            <div class="ax5-ui-menubar {{theme}}">\n                <div class="ax-menu-body">\n                    {{#items}}\n                        {{^@isMenu}}\n                            {{#divide}}\n                            <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                            {{/divide}}\n                            {{#html}}\n                            <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                            {{/html}}\n                        {{/@isMenu}}\n                        {{#@isMenu}}\n                        <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                            {{#icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                            {{/icon}}\n                            <span class="ax-menu-item-cell ax-menu-item-label">{{{label}}}</span>\n                        </div>\n                        {{/@isMenu}}\n                    {{/items}}\n                </div>\n            </div>\n            '},this.__popup=function(t,i,a,c){var s,o,h=t;h.theme=t.theme||e.theme,h.cfg={icons:jQuery.extend({},e.icons),iconWidth:t.iconWidth||e.iconWidth,acceleratorWidth:t.acceleratorWidth||e.acceleratorWidth},i.forEach(function(i){i.html||i.divide?(i["@isMenu"]=!1,i.html&&(i["@html"]=i.html.call({item:i,config:e,opt:t}))):i["@isMenu"]=!0}),h.items=i,h["@depth"]=a,h["@path"]=c||"root",h["@hasChild"]=function(){return this.items&&this.items.length>0},s=jQuery(ax5.mustache.render(this.__getTmpl(),h)),jQuery(document.body).append(s);var u=this.queue.splice(a);return u.forEach(function(e){e.$target.remove()}),this.queue.push({$target:s}),s.find("[data-menu-item-index]").bind("mouseover",function(){var a=this.getAttribute("data-menu-item-depth"),c=this.getAttribute("data-menu-item-index"),o=this.getAttribute("data-menu-item-path");if(s.find("[data-menu-item-index]").removeClass("hover"),jQuery(this).addClass("hover"),s.attr("data-selected-menu-item-index")!=c)if(s.attr("data-selected-menu-item-index",c),i[c].items&&i[c].items.length>0){var h=$(this),u=h.offset(),m={"@parent":{left:u.left,top:u.top,width:h.outerWidth(),height:h.outerHeight()},left:u.left+h.outerWidth()-e.menuBodyPadding,top:u.top-e.menuBodyPadding-1};m=jQuery.extend(!0,t,m),n.__popup(m,i[c].items,a+1,o)}else n.queue.splice(Number(a)+1).forEach(function(e){e.$target.remove()})}),0==a&&(h.direction&&s.addClass("direction-"+h.direction),jQuery(document).bind("click.ax5menu",this.__clickItem.bind(this)),jQuery(window).bind("keydown.ax5menu",function(e){e.which==ax5.info.eventKeys.ESC&&n.close()}),jQuery(window).bind("resize.ax5menu",function(e){n.close()}),e.onStateChanged&&(o={self:this,state:"popup"},e.onStateChanged.call(o,o))),this.__align(s,h),this},this.__clickItem=function(t){var a=i.findParentNode(t.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});if(a){var c=function(e){if(!e)return!1;var t;try{t=Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(n)}catch(i){console.log(ax5.info.getError("ax5menu","501","menuItemClick"))}return t}(a.getAttribute("data-menu-item-path"));if(!c)return this;c.check&&function(e){var t={checkbox:function(e){this.checked=!e},radio:function(t){var i=this.name;e.forEach(function(e){e.check&&"radio"===e.check.type&&e.check.name==i&&(e.check.checked=!1)}),this.checked=!0}};t[this.type]&&t[this.type].call(this,this.checked)}.call(c.check,e.items),n.onClick&&(n.onClick.call(c,c),c.items&&0!=c.items.length||n.close()),e.onClick&&(e.onClick.call(c,c),c.items&&0!=c.items.length||n.close())}else n.close();return this},this.__align=function(t,i){var n=$(window),a=n.height(),c=n.width(),s=t.outerHeight(),o=t.outerWidth(),h=i.left,u=i.top;return h+o>c&&(h=i["@parent"]?i["@parent"].left-o+e.menuBodyPadding:c-o),u+s>a&&(u=a-s),t.css({left:h,top:u}),this},this.popup=function(){var t={event:function(t,i){return t={left:t.clientX,top:t.clientY,width:e.width,theme:e.theme},e.position&&(e.position.left&&(t.left+=e.position.left),e.position.top&&(t.top+=e.position.top)),i=jQuery.extend(!0,t,i)},object:function(t,i){return t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme},e.position&&(e.position.left&&(t.left+=e.position.left),e.position.top&&(t.top+=e.position.top)),i=jQuery.extend(!0,t,i)}};return function(i,n){return i?(n=t["undefined"==typeof i.clientX?"object":"event"].call(this,i,n),this.__popup(n,e.items,0),this):this}}(),this.attach=function(){var t={object:function(t,i){return t={left:t.left,top:t.top,width:t.width||e.width,theme:t.theme||e.theme,direction:t.direction||e.direction},i=jQuery.extend(!0,i,t)}};return function(a,c){var s={},o=e.items;"undefined"==typeof c&&(c={}),s.theme=c.theme||e.theme,s.cfg={icons:jQuery.extend({},e.icons),iconWidth:c.iconWidth||e.iconWidth,acceleratorWidth:c.acceleratorWidth||e.acceleratorWidth},o.forEach(function(t){t.html||t.divide?(t["@isMenu"]=!1,t.html&&(t["@html"]=t.html.call({item:t,config:e,opt:c}))):t["@isMenu"]=!0}),s.items=o,s["@depth"]=0,s["@path"]="root",s["@hasChild"]=function(){return this.items&&this.items.length>0};var h=jQuery(ax5.mustache.render(this.__getTmpl_menuBar(),s));return n.$attachedTarget=jQuery(a),n.$attachedTarget.html(h),n.$attachedTarget.bind("click",function(a){if(!a)return this;var s=i.findParentNode(a.target,function(e){return e.getAttribute("data-menu-item-index")?!0:void 0});if(s){var o=$(s),h=o.offset(),u=o.outerHeight(),m=Number(s.getAttribute("data-menu-item-index"));e.position&&(e.position.left&&(h.left+=e.position.left),e.position.top&&(h.top+=e.position.top)),c=t.object.call(this,{left:h.left,top:h.top+u},c),e.items&&e.items[m].items&&e.items[m].items.length&&n.__popup(c,e.items[m].items,0,"root."+s.getAttribute("data-menu-item-index"))}}),this}}(),this.close=function(){var t;return jQuery(document).unbind("click.ax5menu"),jQuery(window).unbind("keydown.ax5menu"),jQuery(window).unbind("resize.ax5menu"),this.queue.forEach(function(e){e.$target.remove()}),this.queue=[],e.onStateChanged&&(t={self:this,state:"close"},e.onStateChanged.call(t,t)),this},this.getCheckValue=function(){var t={},n=function a(e){for(var n=e.length;n--;)e[n].check&&e[n].check.checked&&(t[e[n].check.name]?(i.isString(t[e[n].check.name])&&(t[e[n].check.name]=[t[e[n].check.name]]),t[e[n].check.name].push(e[n].check.value)):t[e[n].check.name]=e[n].check.value),e[n].items&&e[n].items.length>0&&a(e[n].items)};return n(e.items),t},this.main=function(){arguments&&i.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.menu=function(){return i.isFunction(t)&&(n.prototype=new t),n}()}(ax5.ui,ax5.ui.root);